# ~/.zshrc (interactive)
export EDITOR=hx

# If Ghostty sets TERM=xterm-ghostty but the server has no terminfo entry,
# fallback to xterm-256color to avoid remote warnings/broken UI.
if [ "${TERM:-}" = "xterm-ghostty" ] && command -v infocmp >/dev/null 2>&1; then
  if ! infocmp xterm-ghostty >/dev/null 2>&1; then
    export TERM=xterm-256color
  fi
fi

# ---- modern ls (eza) -------------------------------------------------
if command -v eza >/dev/null 2>&1; then
  alias ls='eza --color=always --icons'
  alias ll='eza -l --color=always --icons'
  alias la='eza -la --color=always --icons'
  alias lt='eza -T --color=always --icons'
fi

# ---- zoxide ----------------------------------------------------------
if command -v zoxide >/dev/null 2>&1; then
  eval "$(zoxide init zsh)"
fi

# ---- starship prompt -------------------------------------------------
if [[ "${TERM:-dumb}" != "dumb" ]] && command -v starship >/dev/null 2>&1; then
  eval "$(starship init zsh)"
fi

# ---- zsh plugins (load if present) ----------------------------------
# Debian/RaspiOS apt locations
if [ -f /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh ]; then
  source /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh
fi

# Syntax highlighting should be loaded last.
if [ -f /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ]; then
  source /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
fi

# Homebrew locations (macOS)
if command -v brew >/dev/null 2>&1; then
  BREW_PREFIX="$(brew --prefix 2>/dev/null)"

  if [ -f "${BREW_PREFIX}/share/zsh-autosuggestions/zsh-autosuggestions.zsh" ]; then
    source "${BREW_PREFIX}/share/zsh-autosuggestions/zsh-autosuggestions.zsh"
  fi

  if [ -f "${BREW_PREFIX}/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" ]; then
    source "${BREW_PREFIX}/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
  fi
fi

# ---- history ---------------------------------------------------------
HISTSIZE=10000
SAVEHIST=10000
HISTFILE="$HOME/.zsh_history"
setopt HIST_IGNORE_DUPS SHARE_HISTORY
